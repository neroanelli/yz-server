<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yz.dao.transfer.BdStudentModifyMapper">
	<resultMap id="BaseResultMap" type="com.yz.model.transfer.BdStudentModify">
		<id column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="ta_name" property="taName" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="file_url" property="fileUrl" jdbcType="VARCHAR" />
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="learn_stage" property="learnStage" jdbcType="VARCHAR" />
        <result column="recruit_type" property="recruitType" jdbcType="VARCHAR" />
		<result column="nta_name" property="ntaName" jdbcType="VARCHAR" />
		<result column="npfsn_name" property="npfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_name" property="pfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_level" property="pfsnLevel" jdbcType="VARCHAR" />
		<result column="nunvs_name" property="nunvsName" jdbcType="VARCHAR" />
		<result column="check_order" property="checkOrder" jdbcType="VARCHAR" />
		<result column="unvs_name" property="unvsName" jdbcType="VARCHAR" />
		<result column="pfsn_code" property="pfsnCode" jdbcType="VARCHAR" />
		<result column="reason" property="reason" jdbcType="VARCHAR" />
		<result column="emp_name" property="empName" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="std_stage" property="stdStage" jdbcType="VARCHAR" />
		<result column="bcruptime" property="bcruptime" jdbcType="VARCHAR" />
		<result column="modify_type" property="modifyType" jdbcType="VARCHAR" />
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="id_type" property="idType" jdbcType="VARCHAR" />
		<result column="nation" property="nation" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<result column="unvs_id" property="unvsId" jdbcType="VARCHAR" />
		<result column="ta_id" property="taId" jdbcType="VARCHAR" />
		<result column="pfsn_id" property="pfsnId" jdbcType="VARCHAR" />
		<result column="scholarship" property="scholarship" jdbcType="VARCHAR" />
		<result column="new_std_name" property="newStdName" jdbcType="VARCHAR" />
		<result column="new_sex" property="newSex" jdbcType="VARCHAR" />
		<result column="new_id_type" property="newIdType" jdbcType="VARCHAR" />
		<result column="new_nation" property="newNation" jdbcType="VARCHAR" />
		<result column="new_id_card" property="newIdCard" jdbcType="VARCHAR" />
		<result column="new_unvs_id" property="newUnvsId" jdbcType="VARCHAR" />
		<result column="new_ta_id" property="newTaId" jdbcType="VARCHAR" />
		<result column="new_pfsn_id" property="newPfsnId" jdbcType="VARCHAR" />
		<result column="npfsn_level" property="npfsnLevel" jdbcType="VARCHAR" />
		<result column="new_scholarship" property="newScholarship"
			jdbcType="VARCHAR" />
		<result column="is_del" property="isDel" jdbcType="CHAR" />
		<result column="update_time" property="updateTime" jdbcType="VARCHAR" />
		<result column="update_user" property="updateUser" jdbcType="VARCHAR" />
		<result column="update_user_id" property="updateUserId"
			jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="VARCHAR" />
		<result column="create_user" property="createUser" jdbcType="VARCHAR" />
		<result column="new_graduate_edcs_type" property="newGraduateEdcsType" jdbcType="VARCHAR" />
		<result column="new_graduate_unvs_name" property="newGraduateUnvsName" jdbcType="VARCHAR" />
		<result column="new_graduate_time" property="newGraduateTime" jdbcType="VARCHAR" />
		<result column="new_graduate_profession" property="newGraduateProfession" jdbcType="VARCHAR" />
		<result column="new_graduate_diploma" property="newGraduateDiploma" jdbcType="VARCHAR" />
		<result column="new_hk_code" property="newHkCode" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="RollBaseResultMap" type="com.yz.model.transfer.BdStudentRollModify">
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="bScholarship" property="bScholarship" jdbcType="VARCHAR" />
		<result column="learn_stage" property="learnStage" jdbcType="VARCHAR" />
        <result column="recruit_type" property="recruitType" jdbcType="VARCHAR" />
		<result column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="std_stage" property="stdStage" jdbcType="VARCHAR" />
		<result column="pfsn_name" property="pfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_level" property="pfsnLevel" jdbcType="VARCHAR" />
		<result column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="ta_name" property="taName" jdbcType="VARCHAR" />
		<result column="nta_name" property="ntaName" jdbcType="VARCHAR" />
		<result column="npfsn_name" property="npfsnName" jdbcType="VARCHAR" />
		<result column="nunvs_name" property="nunvsName" jdbcType="VARCHAR" />
		<result column="check_order" property="checkOrder" jdbcType="VARCHAR" />
		<result column="unvs_name" property="unvsName" jdbcType="VARCHAR" />
		<result column="pfsn_code" property="pfsnCode" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="npfsn_level" property="npfsnLevel" jdbcType="VARCHAR" />
		<result column="modify_type" property="modifyType" jdbcType="VARCHAR" />
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="id_type" property="idType" jdbcType="VARCHAR" />
		<result column="nation" property="nation" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<result column="unvs_id" property="unvsId" jdbcType="VARCHAR" />
		<result column="ta_id" property="taId" jdbcType="VARCHAR" />
		<result column="pfsn_id" property="pfsnId" jdbcType="VARCHAR" />
		<result column="scholarship" property="scholarship" jdbcType="VARCHAR" />
		<result column="new_std_name" property="newStdName" jdbcType="VARCHAR" />
		<result column="new_sex" property="newSex" jdbcType="VARCHAR" />
		<result column="new_id_type" property="newIdType" jdbcType="VARCHAR" />
		<result column="new_nation" property="newNation" jdbcType="VARCHAR" />
		<result column="new_id_card" property="newIdCard" jdbcType="VARCHAR" />
		<result column="new_unvs_id" property="newUnvsId" jdbcType="VARCHAR" />
		<result column="new_ta_id" property="newTaId" jdbcType="VARCHAR" />
		<result column="new_pfsn_id" property="newPfsnId" jdbcType="VARCHAR" />
		<result column="new_scholarship" property="newScholarship"
			jdbcType="VARCHAR" />
		<result column="is_del" property="isDel" jdbcType="CHAR" />
		<result column="update_time" property="updateTime" jdbcType="VARCHAR" />
		<result column="update_user" property="updateUser" jdbcType="VARCHAR" />
		<result column="update_user_id" property="updateUserId"
			jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="VARCHAR" />
		<result column="create_user" property="createUser" jdbcType="VARCHAR" />
		<result column="inclusion_status" property="inclusionStatus" jdbcType="VARCHAR" />
		<result column="score" property="score" jdbcType="VARCHAR" />
		<result column="ext_1" property="ext1" jdbcType="VARCHAR" />
		<collection property="check" ofType="com.yz.model.transfer.BdRollCheckRecord">
		    <result column="cr_id" property="crId" jdbcType="VARCHAR" />
			<result column="reason" property="reason" jdbcType="VARCHAR" />
			<result column="emp_name" property="empName" jdbcType="VARCHAR" />
			<result column="bcrUpdateTime" property="bcrUpdateTime" jdbcType="VARCHAR" />
		</collection>
	</resultMap>
	<resultMap id="StudentInfoMap" type="java.util.Map">
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="EnrollInfoMap" type="java.util.Map">
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="std_stage" property="stdStage" jdbcType="VARCHAR" />
		<result column="scholarship" property="scholarship" jdbcType="VARCHAR" />
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="unvs_name" property="unvsName" jdbcType="VARCHAR" />
		<result column="pfsn_name" property="pfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_level" property="pfsnLevel" jdbcType="VARCHAR" />
		<result column="ta_name" property="taName" jdbcType="VARCHAR" />
		<result column="unvs_id" property="unvsId" jdbcType="VARCHAR" />
		<result column="pfsn_id" property="pfsnId" jdbcType="VARCHAR" />
		<result column="nation" property="nation" jdbcType="VARCHAR" />
		<result column="ta_id" property="taId" jdbcType="VARCHAR" />
		<result column="pfsn_code" property="pfsnCode" jdbcType="VARCHAR" />
		<result column="inclusion_status" property="inclusionStatus" jdbcType="VARCHAR" />
		<result column="score" property="score" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="ResultMap" type="java.util.Map">
		<result column="ta_name" property="taName" jdbcType="VARCHAR" />
		<result column="nta_name" property="ntaName" jdbcType="VARCHAR" />
		<result column="npfsn_name" property="npfsnName" jdbcType="VARCHAR" />
		<result column="nunvs_name" property="nunvsName" jdbcType="VARCHAR" />
		<result column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="cr_id" property="crId" jdbcType="VARCHAR" />
		<result column="std_stage" property="stdStage" jdbcType="VARCHAR" />
		<result column="modify_type" property="modifyType" jdbcType="VARCHAR" />
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="id_type" property="idType" jdbcType="VARCHAR" />
		<result column="nation" property="nation" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<result column="unvs_id" property="unvsId" jdbcType="VARCHAR" />
		<result column="ta_id" property="taId" jdbcType="VARCHAR" />
		<result column="pfsn_id" property="pfsnId" jdbcType="VARCHAR" />
		<result column="scholarship" property="scholarship" jdbcType="VARCHAR" />
		<result column="new_std_name" property="newStdName" jdbcType="VARCHAR" />
		<result column="new_sex" property="newSex" jdbcType="VARCHAR" />
		<result column="new_id_type" property="newIdType" jdbcType="VARCHAR" />
		<result column="new_nation" property="newNation" jdbcType="VARCHAR" />
		<result column="new_id_card" property="newIdCard" jdbcType="VARCHAR" />
		<result column="new_unvs_id" property="newUnvsId" jdbcType="VARCHAR" />
		<result column="new_ta_id" property="newTaId" jdbcType="VARCHAR" />
		<result column="new_pfsn_id" property="newPfsnId" jdbcType="VARCHAR" />
		<result column="new_scholarship" property="newScholarship"
			jdbcType="VARCHAR" />
		<result column="is_del" property="isDel" jdbcType="CHAR" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="VARCHAR" />
		<result column="update_user_id" property="updateUserId"
			jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="create_user" property="createUser" jdbcType="VARCHAR" />
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="learn_stage" property="learnStage" jdbcType="VARCHAR" />
		<result column="pfsn_name" property="pfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_level" property="pfsnLevel" jdbcType="VARCHAR" />
		<result column="unvs_name" property="unvsName" jdbcType="VARCHAR" />
		<result column="pfsn_code" property="pfsnCode" jdbcType="VARCHAR" />
		<result column="recruit_type" property="recruitType" jdbcType="VARCHAR" />
		<result column="check_status" property="checkStatus" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="RollResultMap" type="com.yz.model.transfer.StudentRollModifyMap">
		<result column="ta_name" property="taName" jdbcType="VARCHAR" />
		<result column="nta_name" property="ntaName" jdbcType="VARCHAR" />
		<result column="bScholarship" property="bScholarship" jdbcType="VARCHAR" />
		<result column="npfsn_name" property="npfsnName" jdbcType="VARCHAR" />
		<result column="nunvs_name" property="nunvsName" jdbcType="VARCHAR" />
		<result column="modify_id" property="modifyId" jdbcType="VARCHAR" />
		<result column="learn_id" property="learnId" jdbcType="VARCHAR" />
		<result column="check_order" property="checkOrder" jdbcType="VARCHAR" />
		<result column="std_id" property="stdId" jdbcType="VARCHAR" />
		<result column="cr_id" property="crId" jdbcType="VARCHAR" />
		<result column="std_stage" property="stdStage" jdbcType="VARCHAR" />
		<result column="modify_type" property="modifyType" jdbcType="VARCHAR" />
		<result column="std_name" property="stdName" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="id_type" property="idType" jdbcType="VARCHAR" />
		<result column="nation" property="nation" jdbcType="VARCHAR" />
		<result column="id_card" property="idCard" jdbcType="VARCHAR" />
		<result column="unvs_id" property="unvsId" jdbcType="VARCHAR" />
		<result column="ta_id" property="taId" jdbcType="VARCHAR" />
		<result column="pfsn_id" property="pfsnId" jdbcType="VARCHAR" />
		<result column="scholarship" property="scholarship" jdbcType="VARCHAR" />
		<result column="new_std_name" property="newStdName" jdbcType="VARCHAR" />
		<result column="new_sex" property="newSex" jdbcType="VARCHAR" />
		<result column="new_id_type" property="newIdType" jdbcType="VARCHAR" />
		<result column="new_nation" property="newNation" jdbcType="VARCHAR" />
		<result column="new_id_card" property="newIdCard" jdbcType="VARCHAR" />
		<result column="new_unvs_id" property="newUnvsId" jdbcType="VARCHAR" />
		<result column="new_ta_id" property="newTaId" jdbcType="VARCHAR" />
		<result column="new_pfsn_id" property="newPfsnId" jdbcType="VARCHAR" />
		<result column="new_scholarship" property="newScholarship"
			jdbcType="VARCHAR" />
		<result column="is_del" property="isDel" jdbcType="CHAR" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
		<result column="update_user" property="updateUser" jdbcType="VARCHAR" />
		<result column="update_user_id" property="updateUserId"
			jdbcType="VARCHAR" />
		<result column="create_user_id" property="createUserId"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="create_user" property="createUser" jdbcType="VARCHAR" />
		<result column="grade" property="grade" jdbcType="VARCHAR" />
		<result column="learn_stage" property="learnStage" jdbcType="VARCHAR" />
		<result column="pfsn_name" property="pfsnName" jdbcType="VARCHAR" />
		<result column="pfsn_level" property="pfsnLevel" jdbcType="VARCHAR" />
		<result column="unvs_name" property="unvsName" jdbcType="VARCHAR" />
		<result column="pfsn_code" property="pfsnCode" jdbcType="VARCHAR" />
		<result column="recruit_type" property="recruitType" jdbcType="VARCHAR" />
		<result column="check_status" property="checkStatus" jdbcType="VARCHAR" />
		<result column="inclusion_status" property="inclusionStatus" jdbcType="VARCHAR" />
		<result column="new_pfsn_level" property="newPfsnLevel" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		modify_id, learn_id, std_id, modify_type, std_name, sex,
		id_type, nation,
		id_card,
		unvs_id, ta_id, pfsn_id, scholarship,
		new_std_name, new_sex, new_id_type,
		new_nation,
		new_id_card,
		new_unvs_id, new_ta_id, new_pfsn_id, new_scholarship, is_del,
		update_time,
		update_user, update_user_id, create_user_id, create_time,
		create_user, ext_1,
		ext_2,
		ext_3
	</sql>
	
	<select id="selectUnSameTestSubjectByPfsnId" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT 
		  b.`subject_id` 
		FROM
		  bd_unvs_profession bup 
		  LEFT JOIN bd_test_group g 
		    ON bup.`group_id` = g.`group_id` 
		  LEFT JOIN bd_tg t 
		    ON t.`group_id` = g.`group_id` 
		  LEFT JOIN bd_test_subject b 
		    ON b.`subject_id` = t.`subject_id` 
		WHERE bup.pfsn_id = #{oldPfsnId}
		  AND b.`subject_id` NOT IN 
		  (SELECT 
		    b.`subject_id` 
		  FROM
		    bd_unvs_profession bup 
		    LEFT JOIN bd_test_group g 
		      ON bup.`group_id` = g.`group_id` 
		    LEFT JOIN bd_tg t 
		      ON t.`group_id` = g.`group_id` 
		    LEFT JOIN bd_test_subject b 
		      ON b.`subject_id` = t.`subject_id` 
		  WHERE bup.pfsn_id = #{newPfsnId})
	</select>
	
	<select id="selectModifyFinishCount" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from bd_student_modify where modify_id = #{modifyId} AND is_complete = '1'
	</select>
	
	<select id="updateBdOrderInfo" parameterType="java.lang.String">
		
	</select>
	
	<select id="selectRecruitEmpId" parameterType="java.lang.String" resultType="java.lang.String">
		select 
		  r.recruit 
		from
		  bd_learn_rules r 
		where r.`learn_id` = #{learnid} 
	</select>
	
	<update id="updateStdStageBack" parameterType="java.lang.String">
		update bd_learn_info bli set bli.std_stage = #{stdStage} where bli.learn_id = #{learnId}
	</update>
	
	<update id="destroyOrderByLearnId" parameterType="java.lang.String">
		update 
		  bd_student_order o 
		  inner join bd_sub_order s 
		    on s.order_no = o.order_no set s.sub_order_status = '4' 
		where o.learn_id = #{learnId}
	</update>
	
	<update id="updateStdStageByLearnId" parameterType="java.lang.String">
		update bd_learn_info bli set bli.std_stage = '1' where bli.learn_id = #{learnId}
	</update>
	
	<select id="selectPaidAmountByLearnId" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT 
		  SUM(a.amount) 
		FROM
		  bd_sub_serial a 
		WHERE a.`sub_serial_no` IN 
		  (SELECT 
		    l.`sub_serial_no` 
		  FROM
		    bd_student_order o 
		    LEFT JOIN bd_sub_order s 
		      ON s.`order_no` = o.`order_no` 
		    LEFT JOIN bd_serial_suborder ss 
		      ON ss.`sub_order_no` = s.`sub_order_no` 
		    LEFT JOIN bd_student_serial e 
		      ON e.`serial_no` = ss.`serial_no` 
		    LEFT JOIN bd_sub_serial l 
		      ON l.`serial_no` = e.`serial_no` 
		  WHERE s.sub_order_status = '2' 
		    AND o.`learn_id` = #{learnId}
		    AND l.`payment_type` IN ('1', '2', '4', '6', '9', '11', '12') 
		    AND e.`serial_status` IN ('2', '3') 
		    AND l.`sub_serial_status` IN ('2', '3') 
		  GROUP BY l.`sub_serial_no`)
	</select>
	
	<select id="selectNowFeeId" resultType="java.lang.String" parameterType="java.lang.String">
		select bli.fee_id from bd_learn_info bli where bli.learn_id = #{learnId}
	</select>
	
	<select id="selectFeeStandard" resultType="java.lang.String" parameterType="java.lang.String">
		SELECT 
		  bp.fee_id 
		FROM
		  `bd_ptf` bp 
		  LEFT JOIN bd_fee f 
		  ON f.`fee_id` = bp.`fee_id`
		WHERE bp.`ta_id` = #{taId}
		  AND bp.`pfsn_id` = #{pfsnId}
		  AND scholarship = #{scholarship}
		  AND f.`status` = '1' 
		group by bp.`fee_id` 
	</select>
	
	<select id="selectOfferTutorAmount" resultType="java.lang.String" parameterType="java.lang.String">
		select 
		  d.`define_amount` 
		from
		  bd_offer f 
		  left join bd_offer_define d 
		    on d.`offer_id` = f.`offer_id` 
		where f.`offer_id` = #{offerId}
		  and d.`item_code` = 'Y0' 
	</select>
	
	<select id="selectOfferId" resultType="java.lang.String" parameterType="java.lang.String">
		select 
		  f.`offer_id` 
		from
		  bd_pto o 
		  left join bd_offer f 
		    on f.`offer_id` = o.`offer_id` 
		where o.`pfsn_id` = #{pfsnId} 
		  and o.`scholarship` = #{scholarship}
		  and o.`ta_id` = #{taId}
		  and (
		    now() between f.`start_time` 
		    and f.`expire_time`
		  ) 
		  and f.`status` = '1' 
		group by f.`offer_id`
	</select>
	
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from bd_student_modify
		where modify_id = #{modifyId,jdbcType=VARCHAR}
	</select>
	<select id="findStudentEnrollInfo" resultMap="EnrollInfoMap">
		SELECT
		bli.`learn_id`,
		bli.`std_id`,
		bli.`grade`,
		bli.`std_stage`,
		bli.`scholarship`,
		bli.`ta_id`,
		bsi.`std_name`,
		bsi.`id_card`,
		bsi.`sex`,
		bsi.`nation`,
		bu.`unvs_name`,
		bu.`unvs_id`,
		bup.`pfsn_id`,
		bup.`pfsn_name`,
		bup.`pfsn_code`,
		bup.`pfsn_level`,
		bta.`ta_name`,
		bli.inclusion_status,
		score.score
		FROM
		bd_learn_info bli
		LEFT JOIN bd_student_info bsi
		ON bli.`std_id` =
		bsi.`std_id`
		LEFT JOIN bd_unvs_profession bup
		ON bup.`pfsn_id` =
		bli.`pfsn_id`
		LEFT JOIN bd_university bu
		ON bu.`unvs_id` = bli.`unvs_id`
		LEFT JOIN bd_test_area bta
		ON bta.`ta_id` = bli.`ta_id`
		LEFT JOIN (
			SELECT learn_id,SUM(score) score FROM bd_student_e_score GROUP BY learn_id
		) score
		ON bli.learn_id = score.learn_id
		WHERE
		bli.`learn_id` = #{learnId}
	</select>
	<select id="findStudentInfo" resultMap="StudentInfoMap"
		parameterType="java.lang.String">
		SELECT 
			bsi.`std_name`,bsi.`std_id`,bli.grade,bli.learn_id
		FROM
		  bd_learn_info bli 
		  inner JOIN bd_student_info bsi 
		    ON bsi.`std_id` = bli.`std_id` 
		  left join bd_student_modify m 
		    on m.`learn_id` = bli.`learn_id`
		  LEFT JOIN bd_learn_rules r 
		    ON r.`learn_id` = bli.`learn_id`  
		    left join bd_student_scene_confirm c on c.learn_id=bli.learn_id
		WHERE (
		    m.`is_complete` = '1' 
		    or m.`modify_id` is null
		  )
          and (c.web_register_status = '0' or c.web_register_status is null)
		  AND bli.`std_stage` IN
		<foreach item="item" index="index" collection="stauts" open="("
			separator="," close=")">
			#{item}
		</foreach>
		<if test="sName != null and sName != ''">
			AND (bsi.`id_card` = #{sName,jdbcType=VARCHAR} or
			bsi.`std_name` like CONCAT('%',#{sName,jdbcType=VARCHAR},'%')
			)
		</if>
		<if test="user.userLevel != 1">
			<choose>
				<when test="user.userLevel == 2">
					and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit_campus_id in (
					<foreach collection="user.myCampusList" item="info" separator=",">
						#{info.campusId, jdbcType=VARCHAR}
					</foreach>
					))
				</when>
				<when test="user.userLevel == 3">
					and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit_dp_id in (
					<foreach collection="user.myDpList" item="info" separator=",">
						#{info.dpId, jdbcType=VARCHAR}
					</foreach>
					))
				</when>
				<when test="user.userLevel == 4">
					and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit in (
					<foreach collection="user.myEmplyeeList" item="info" separator=",">
						#{info.empId, jdbcType=VARCHAR}
					</foreach>
					))
				</when>
				<when test="user.userLevel == 14">
					and bli.std_stage in ('1','2','3','4','5','6','12','13')
				</when>
				<otherwise>
					and r.recruit = #{user.empId, jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		group by bli.`learn_id`
		ORDER BY bli.`update_time` DESC
	</select>
	<select id="findStudentRollModifyById" resultMap="RollBaseResultMap"
		parameterType="java.lang.String">
		SELECT
		bsm.*,
		bli.`scholarship` bScholarship,
		bli.`grade`,
		bli.`learn_stage`,
		bli.`std_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bcr.`cr_id`,
		bcr.`update_time` bcrUpdateTime,
		bcr.`reason`,
		oe.`emp_name`,
		bta.`ta_name`,
		(SELECT
		pfsn_name
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_name,
		(SELECT
		pfsn_level
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_level,
		(SELECT
		unvs_name
		FROM
		bd_university
		WHERE unvs_id = bsm.`new_unvs_id`) nunvs_name,
		(SELECT
		ta_name
		FROM
		bd_test_area
		WHERE ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN bd_unvs_profession bup
		ON bup.`pfsn_id` = bli.`pfsn_id`
		LEFT JOIN bd_university bu
		ON bu.`unvs_id` = bli.`unvs_id`
		LEFT JOIN bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`
		LEFT JOIN `oa_employee` oe
		ON bcr.`emp_id` = oe.`emp_id`
		LEFT JOIN bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		WHERE bsm.`modify_id` =
		#{modifyId,jdbcType=VARCHAR} ORDER BY bcr.`check_order` ASC
	</select>
	<select id="findStudentModifyById" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		SELECT
		bsm.*,
		si.`mobile`,
		bli.`learn_id`,
		bli.`std_id`,
		bli.`grade`,
		bli.`scholarship`,
		bli.`learn_stage`,
		bli.`std_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bcr.`check_status`,
		date_format(bcr.`update_time`,'%Y-%m-%d %H:%i:%s') bcruptime,
		bcr.`reason`,
		oe.`emp_name`,
		bta.`ta_name`,
		(SELECT
		pfsn_name
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_name,
		(SELECT
		pfsn_level
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_level,
		(SELECT
		unvs_name
		FROM
		bd_university
		WHERE unvs_id = bsm.`new_unvs_id`) nunvs_name,
		(SELECT
		ta_name
		FROM
		bd_test_area
		WHERE ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN bd_unvs_profession bup
		ON bup.`pfsn_id` = bsm.`pfsn_id`
		LEFT JOIN bd_university bu
		ON bu.`unvs_id` = bsm.`unvs_id`
		LEFT JOIN bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`
		LEFT JOIN `oa_employee` oe
		ON bcr.`emp_id` = oe.`emp_id`
		LEFT JOIN bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		left join bd_student_info si
		on si.std_id = bli.std_id
		WHERE bsm.`modify_id` =
		#{modifyId,jdbcType=VARCHAR} LIMIT 1
	</select>
	<select id="findStudentAuditModify" resultMap="ResultMap"
		parameterType="com.yz.model.transfer.StudentModifyMap">
		SELECT
		bsm.*,
		bli.`grade`,
		bli.`std_stage`,
		bli.`learn_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bcr.`check_status`,
		bcr.`cr_id`,
		bta.`ta_name`,
		(SELECT pfsn_name
		FROM bd_unvs_profession WHERE pfsn_id = bsm.`new_pfsn_id`)
		npfsn_name,
		(SELECT unvs_name FROM bd_university WHERE unvs_id =
		bsm.`new_unvs_id`)
		nunvs_name,
		(SELECT ta_name FROM bd_test_area WHERE
		ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN
		bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN
		bd_unvs_profession bup
		ON bup.`pfsn_id` = bli.`pfsn_id`
		LEFT JOIN
		bd_university bu
		ON bu.`unvs_id` = bli.`unvs_id`
		LEFT JOIN
		bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`
		LEFT JOIN
		bd_student_info bsi
		ON bsi.`std_id` = bsm.`std_id`
		LEFT JOIN
		bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		WHERE bsm.`modify_type` =
		1 AND bcr.`check_status` = 1
		<if test="stdName != null and stdName != ''">
			AND bsm.`std_name` = #{stdName,jdbcType=VARCHAR}
		</if>
		<if test="idCard != null and idCard != ''">
			AND bsm.`id_card` = #{idCard,jdbcType=VARCHAR}
		</if>
		<if test="mobile != null and mobile != ''">
			AND bsi.`mobile` = #{mobile,jdbcType=VARCHAR}
		</if>
		<if test="unvsName != null and unvsName != ''">
			AND bu.`unvs_name` = #{unvsName,jdbcType=VARCHAR}
		</if>
		<if test="pfsnName != null and pfsnName != ''">
			AND bup.`pfsn_name` = #{pfsnName,jdbcType=VARCHAR}
		</if>
		<if test="stdStage != null and stdStage != ''">
			AND bli.`std_stage` = #{stdStage,jdbcType=VARCHAR}
		</if>
		order by create_time desc
	</select>
	<select id="findStudentAuditRollModify" resultMap="RollResultMap"
		parameterType="com.yz.model.transfer.StudentModifyMap">
		SELECT
		bsm.*,
		bli.`grade`,
		bli.`scholarship` bScholarship,
		bli.`std_stage`,
		bli.`learn_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bcr.`check_status`,
		bta.`ta_name`,
		(SELECT pfsn_name
		FROM bd_unvs_profession WHERE pfsn_id = bsm.`new_pfsn_id`)
		npfsn_name,
		(SELECT unvs_name FROM bd_university WHERE unvs_id =
		bsm.`new_unvs_id`)
		nunvs_name,
		(SELECT ta_name FROM bd_test_area WHERE
		ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN
		bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN
		bd_unvs_profession bup
		ON bup.`pfsn_id` = bli.`pfsn_id`
		LEFT JOIN
		bd_university bu
		ON bu.`unvs_id` = bli.`unvs_id`
		LEFT JOIN
		bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`AND bcr.`check_order` = bsm.`check_order`
		LEFT JOIN
		bd_student_info bsi
		ON bsi.`std_id` = bsm.`std_id`
		LEFT JOIN
		bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		WHERE bsm.`modify_type` =
		2 AND bcr.`check_status` = 1
		<if test="stdName != null and stdName != ''">
			AND bsm.`std_name` = #{stdName,jdbcType=VARCHAR}
		</if>
		<if test="idCard != null and idCard != ''">
			AND bsm.`id_card` = #{idCard,jdbcType=VARCHAR}
		</if>
		<if test="checkOrder != null and checkOrder != ''">
			AND bsm.`check_order` = #{checkOrder,jdbcType=VARCHAR}
		</if>
		<if test="mobile != null and mobile != ''">
			AND bsi.`mobile` = #{mobile,jdbcType=VARCHAR}
		</if>
		<if test="unvsName != null and unvsName != ''">
			AND bu.`unvs_name` = = #{unvsName,jdbcType=VARCHAR}
		</if>
		<if test="pfsnName != null and pfsnName != ''">
			AND bup.`pfsn_name`, = #{pfsnName,jdbcType=VARCHAR}
		</if>
		<if test="checkStatus != null and checkStatus != ''">
			AND bcr.`check_status` = #{checkStatus,jdbcType=VARCHAR}
		</if>
		<if test="stdStage != null and stdStage != ''">
			AND bli.`std_stage` = #{stdStage,jdbcType=VARCHAR}
		</if>
		order by create_time desc
	</select>
	<select id="findStudentRollModify" resultMap="RollResultMap"
		parameterType="com.yz.model.transfer.StudentModifyMap">
		SELECT
		bsm.*,
		bli.`grade`,
		bli.`std_stage`,
		bli.`learn_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bcr.`check_status`,
		bta.`ta_name`,
		(SELECT pfsn_name
		FROM bd_unvs_profession WHERE pfsn_id = bsm.`new_pfsn_id`)
		npfsn_name,
		(SELECT unvs_name FROM bd_university WHERE unvs_id =
		bsm.`new_unvs_id`)
		nunvs_name,
		(SELECT ta_name FROM bd_test_area WHERE
		ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN
		bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN
		bd_unvs_profession bup
		ON bup.`pfsn_id` = bli.`pfsn_id`
		LEFT JOIN
		bd_university bu
		ON bu.`unvs_id` = bli.`unvs_id`
		LEFT JOIN
		bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`AND bcr.`check_order` = bsm.`check_order`
		LEFT JOIN
		bd_student_info bsi
		ON bsi.`std_id` = bsm.`std_id`
		LEFT JOIN
		bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		WHERE bsm.`modify_type` =
		2
		<if test="stdName != null and stdName != ''">
			AND bsm.`std_name` = #{stdName,jdbcType=VARCHAR}
		</if>
		<if test="idCard != null and idCard != ''">
			AND bsm.`id_card` = #{idCard,jdbcType=VARCHAR}
		</if>
		<if test="mobile != null and mobile != ''">
			AND bsi.`mobile` = #{mobile,jdbcType=VARCHAR}
		</if>
		<if test="unvsName != null and unvsName != ''">
			AND bu.`unvs_name` = = #{unvsName,jdbcType=VARCHAR}
		</if>
		<if test="pfsnName != null and pfsnName != ''">
			AND bup.`pfsn_name`, = #{pfsnName,jdbcType=VARCHAR}
		</if>
		<if test="checkStatus != null and checkStatus != ''">
			AND bcr.`check_status` = #{checkStatus,jdbcType=VARCHAR}
		</if>
		<if test="stdStage != null and stdStage != ''">
			AND bli.`std_stage` = #{stdStage,jdbcType=VARCHAR}
		</if>
		order by create_time desc
	</select>
	
	<select id="findStudentModify" resultMap="ResultMap"
		parameterType="com.yz.model.transfer.StudentModifyMap">
		SELECT 
		  bsm.*,
		  bli.`grade`,
		  bli.`std_stage`,
		  bli.`learn_stage`,
		  bup.`pfsn_name`,
		  bup.`pfsn_level`,
		  bup.`pfsn_code`,
		  bu.`unvs_name`,
		  bu.`recruit_type`,
		  bcr.`check_status`,
		  bta.`ta_name`,
		  (SELECT 
		    pfsn_name 
		  FROM
		    bd_unvs_profession 
		  WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_name,
		  (SELECT 
		    unvs_name 
		  FROM
		    bd_university 
		  WHERE unvs_id = bsm.`new_unvs_id`) nunvs_name,
		  (SELECT 
		    ta_name 
		  FROM
		    bd_test_area 
		  WHERE ta_id = bsm.`new_ta_id`) nta_name 
		FROM
		  `bd_student_modify` bsm 
		  INNER JOIN bd_learn_info bli 
		    ON bsm.`learn_id` = bli.`learn_id` 
		  INNER JOIN bd_unvs_profession bup 
		    ON bup.`pfsn_id` = bsm.`pfsn_id` 
		  INNER JOIN bd_university bu 
		    ON bu.`unvs_id` = bsm.`unvs_id` 
		  LEFT JOIN bd_check_record bcr 
		    ON bcr.`mapping_id` = bsm.`modify_id`
		  INNER JOIN bd_student_info bsi 
		    ON bsi.`std_id` = bsm.`std_id` 
		  INNER JOIN bd_test_area bta 
		    ON bta.`ta_id` = bsm.`ta_id` 
		  LEFT JOIN bd_learn_rules r
		    ON r.learn_id = bli.learn_id
		WHERE bsm.`modify_type` = 1 
		<if test="modi.stdName != null and modi.stdName != ''">
			AND bsm.`std_name` LIKE CONCAT('%', #{modi.stdName,jdbcType=VARCHAR}, '%')
		</if>
		<if test="modi.idCard != null and modi.idCard != ''">
			AND bsm.`id_card` = #{modi.idCard,jdbcType=VARCHAR}
		</if>
		<if test="modi.mobile != null and modi.mobile != ''">
			AND bsi.`mobile` LIKE CONCAT('%', #{modi.mobile,jdbcType=VARCHAR}, '%')
		</if>
		<if test="modi.unvsName != null and modi.unvsName != ''">
			AND bu.`unvs_name` LIKE CONCAT('%', #{modi.unvsName,jdbcType=VARCHAR}, '%')
		</if>
		<if test="modi.pfsnName != null and modi.pfsnName != ''">
			AND bup.`pfsn_name` LIKE CONCAT('%', #{modi.pfsnName,jdbcType=VARCHAR}, '%')
		</if>
		<if test="modi.checkStatus != null and modi.checkStatus != ''">
			AND bcr.`check_status` = #{modi.checkStatus,jdbcType=VARCHAR}
		</if>
		<if test="modi.stdStage != null and modi.stdStage != ''">
			AND bli.`std_stage` = #{modi.stdStage,jdbcType=VARCHAR}
		</if>
		<if test="user.userLevel != 1">
				<choose>
					<when test="user.userLevel == 2">
						and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit_campus_id in (
						<foreach collection="user.myCampusList" item="info" separator=",">
							#{info.campusId, jdbcType=VARCHAR}
						</foreach>
						))
					</when>
					<when test="user.userLevel == 3">
						and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit_dp_id in (
						<foreach collection="user.myDpList" item="info" separator=",">
							#{info.dpId, jdbcType=VARCHAR}
						</foreach>
						))
					</when>
					<when test="user.userLevel == 4">
						and (r.recruit = #{user.empId, jdbcType=VARCHAR} or r.recruit in (
						<foreach collection="user.myEmplyeeList" item="info" separator=",">
							#{info.empId, jdbcType=VARCHAR}
						</foreach>
						))
					</when>
					<when test="user.userLevel == 14">
						and bli.std_stage in ('1','2','3','4','5','6','12','13')
					</when>
					<otherwise>
						and r.recruit = #{user.empId, jdbcType=VARCHAR}
					</otherwise>
				</choose>
			</if>
			order by create_time desc
	</select>
	
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		delete from
		bd_student_modify
		where modify_id = #{modifyId,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.yz.model.transfer.BdStudentModify">
		insert into bd_student_modify
		(modify_id, learn_id, std_id,
		modify_type, std_name, sex,
		id_type,
		nation, id_card,
		unvs_id, ta_id, pfsn_id,
		scholarship,old_std_stage,new_std_stage, new_std_name,
		new_sex,
		new_id_type, new_nation, new_id_card,
		new_unvs_id, new_ta_id,
		new_pfsn_id,
		new_scholarship, is_del, update_time,
		update_user,
		update_user_id, create_user_id,
		create_time, create_user, ext_1,
		ext_2,
		ext_3)
		values (#{modifyId,jdbcType=VARCHAR},
		#{learnId,jdbcType=VARCHAR},
		#{stdId,jdbcType=VARCHAR},
		#{modifyType,jdbcType=VARCHAR}, #{stdName,jdbcType=VARCHAR},
		#{sex,jdbcType=VARCHAR},
		#{idType,jdbcType=VARCHAR},
		#{nation,jdbcType=VARCHAR},
		#{idCard,jdbcType=VARCHAR},
		#{unvsId,jdbcType=VARCHAR}, #{taId,jdbcType=VARCHAR},
		#{pfsnId,jdbcType=VARCHAR},
		#{scholarship,jdbcType=VARCHAR},#{oldStdStage,jdbcType=VARCHAR},#{newStdStage,jdbcType=VARCHAR},
		#{newStdName,jdbcType=VARCHAR},
		#{newSex,jdbcType=VARCHAR},
		#{newIdType,jdbcType=VARCHAR}, #{newNation,jdbcType=VARCHAR},
		#{newIdCard,jdbcType=VARCHAR},
		#{newUnvsId,jdbcType=VARCHAR},
		#{newTaId,jdbcType=VARCHAR},
		#{newPfsnId,jdbcType=VARCHAR},
		#{newScholarship,jdbcType=VARCHAR}, #{isDel,jdbcType=CHAR},
		#{updateTime,jdbcType=TIMESTAMP},
		#{updateUser,jdbcType=VARCHAR},
		#{updateUserId,jdbcType=VARCHAR},
		#{createUserId,jdbcType=VARCHAR},
		#{createTime,jdbcType=TIMESTAMP}, #{createUser,jdbcType=VARCHAR},
		#{ext1,jdbcType=VARCHAR},
		#{ext2,jdbcType=VARCHAR},
		#{ext3,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.yz.model.transfer.BdStudentModify">
		insert into bd_student_modify
		<trim prefix="(" suffix=")" suffixOverrides=",">
			modify_id,
			<if test="learnId != null and learnId != ''">
				learn_id,
			</if>
			<if test="stdId != null and stdId != ''">
				std_id,
			</if>
			<if test="modifyType != null and modifyType != ''">
				modify_type,
			</if>
			<if test="checkType != null and checkType != ''">
				check_type,
			</if>
			<if test="stdName != null and stdName != ''">
				std_name,
			</if>
			<if test="sex != null and sex != ''">
				sex,
			</if>
			<if test="idType != null and idType != ''">
				id_type,
			</if>
			<if test="nation != null and nation != ''">
				nation,
			</if>
			<if test="idCard != null and idCard != ''">
				id_card,
			</if>
			<if test="unvsId != null and unvsId != ''">
				unvs_id,
			</if>
			<if test="taId != null and taId != ''">
				ta_id,
			</if>
			<if test="pfsnId != null and pfsnId != ''">
				pfsn_id,
			</if>
			<if test="sg != null and sg != ''">
				sg,
			</if>
			<if test="scholarship != null and scholarship != ''">
				scholarship,
			</if>
			<if test="oldStdStage != null and oldStdStage != ''">
				old_std_stage,
			</if>
			<if test="newStdStage != null and newStdStage != ''">
				new_std_stage,
			</if>
			<if test="newStdName != null and newStdName != ''">
				new_std_name,
			</if>
			<if test="newSex != null and newSex != ''">
				new_sex,
			</if>
			<if test="newIdType != null and newIdType != ''">
				new_id_type,
			</if>
			<if test="newNation != null and newNation != ''">
				new_nation,
			</if>
			<if test="newIdCard != null and newIdCard != ''">
				new_id_card,
			</if>
			<if test="newUnvsId != null and newUnvsId != ''">
				new_unvs_id,
			</if>
			<if test="newTaId != null and newTaId != ''">
				new_ta_id,
			</if>
			<if test="newPfsnId != null and newPfsnId != ''">
				new_pfsn_id,
			</if>
			<if test="newSg != null and newSg != ''">
				new_sg,
			</if>
			<if test="newScholarship != null and newScholarship != ''">
				new_scholarship,
			</if>
			<if test="isDel != null and isDel != ''">
				is_del,
			</if>
			<if test="updateUser != null and updateUser != ''">
				update_user,
			</if>
			<if test="updateUserId != null and updateUserId != ''">
				update_user_id,
			</if>
			<if test="createUserId != null and createUserId != ''">
				create_user_id,
			</if>
			<if test="createUser != null and createUser != ''">
				create_user,
			</if>
			<if test="checkOrder != null and checkOrder != ''">
				check_order,
			</if>
			<if test="ext1 != null and ext1 != ''">
				ext_1,
			</if>
			<if test="ext3 != null and ext3 != ''">
				ext_3,
			</if>
			<if test="isComplete != null and isComplete != ''">
				is_complete,
			</if>
			<if test="remark != null and remark != ''">
				remark,
			</if>
			<if test="fileUrl != null and fileUrl != ''">
				file_url,
			</if>
			<if test="graduateUnvsName != null and graduateUnvsName != ''">
				graduate_unvs_name,
			</if>
			<if test="graduateTime != null and graduateTime != ''">
				graduate_time,
			</if>
			<if test="graduateEdcsType != null and graduateEdcsType != ''">
				graduate_edcs_type,
			</if>
			<if test="graduateProfession != null and graduateProfession != ''">
				graduate_profession,
			</if>
			<if test="graduateDiploma != null and graduateDiploma != ''">
				graduate_diploma,
			</if>
			<if test="newGraduateUnvsName != null and newGraduateUnvsName != ''">
				new_graduate_unvs_name,
			</if>
			<if test="newGraduateTime != null and newGraduateTime != ''">
				new_graduate_time,
			</if>
			<if test="newGraduateEdcsType != null and newGraduateEdcsType != ''">
				new_graduate_edcs_type,
			</if>
			<if test="newGraduateProfession != null and newGraduateProfession != ''">
				new_graduate_profession,
			</if>
			<if test="newGraduateDiploma != null and newGraduateDiploma != ''">
				new_graduate_diploma,
			</if>
			<if test="rprAddress != null and rprAddress != ''">
				rpr_address,
			</if>
			<if test="newHkCode != null and newHkCode != ''">
				new_hk_code,
			</if>
			<if test="newRprAddress != null and newRprAddress != ''">
				new_rpr_address,
			</if>
			update_time
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			#{modifyId,jdbcType=VARCHAR},
			<if test="learnId != null  and learnId != ''">
				#{learnId,jdbcType=VARCHAR},
			</if>
			<if test="stdId != null  and stdId != ''">
				#{stdId,jdbcType=VARCHAR},
			</if>
			<if test="modifyType != null  and modifyType != ''">
				#{modifyType,jdbcType=VARCHAR},
			</if>
			<if test="checkType != null  and checkType != ''">
				#{checkType,jdbcType=VARCHAR},
			</if>
			<if test="stdName != null  and stdName != ''">
				#{stdName,jdbcType=VARCHAR},
			</if>
			<if test="sex != null  and sex != ''">
				#{sex,jdbcType=VARCHAR},
			</if>
			<if test="idType != null and idType != ''">
				#{idType,jdbcType=VARCHAR},
			</if>
			<if test="nation != null and nation != ''">
				#{nation,jdbcType=VARCHAR},
			</if>
			<if test="idCard != null and idCard != ''">
				#{idCard,jdbcType=VARCHAR},
			</if>
			<if test="unvsId != null and unvsId != ''">
				#{unvsId,jdbcType=VARCHAR},
			</if>
			<if test="taId != null and taId != ''">
				#{taId,jdbcType=VARCHAR},
			</if>
			<if test="pfsnId != null and pfsnId != ''">
				#{pfsnId,jdbcType=VARCHAR},
			</if>
			<if test="sg != null and sg != ''">
				#{sg,jdbcType=VARCHAR},
			</if>
			<if test="scholarship != null and scholarship != ''">
				#{scholarship,jdbcType=VARCHAR},
			</if>
			<if test="oldStdStage != null and oldStdStage != ''">
				#{oldStdStage,jdbcType=VARCHAR},
			</if>
			<if test="newStdStage != null and newStdStage != ''">
				#{newStdStage,jdbcType=VARCHAR},
			</if>
			<if test="newStdName != null and newStdName != ''">
				#{newStdName,jdbcType=VARCHAR},
			</if>
			<if test="newSex != null and newSex != ''">
				#{newSex,jdbcType=VARCHAR},
			</if>
			<if test="newIdType != null and newIdType != ''">
				#{newIdType,jdbcType=VARCHAR},
			</if>
			<if test="newNation != null and newNation != ''">
				#{newNation,jdbcType=VARCHAR},
			</if>
			<if test="newIdCard != null and newIdCard != ''">
				#{newIdCard,jdbcType=VARCHAR},
			</if>
			<if test="newUnvsId != null and newUnvsId != ''">
				#{newUnvsId,jdbcType=VARCHAR},
			</if>
			<if test="newTaId != null and newTaId != ''">
				#{newTaId,jdbcType=VARCHAR},
			</if>
			<if test="newPfsnId != null and newPfsnId != ''">
				#{newPfsnId,jdbcType=VARCHAR},
			</if>
			<if test="newSg != null and newSg != ''">
				#{newSg,jdbcType=VARCHAR},
			</if>
			<if test="newScholarship != null and newScholarship != ''">
				#{newScholarship,jdbcType=VARCHAR},
			</if>
			<if test="isDel != null and isDel != ''">
				#{isDel,jdbcType=CHAR},
			</if>
			<if test="updateUser != null and updateUser != ''">
				#{updateUser,jdbcType=VARCHAR},
			</if>
			<if test="updateUserId != null and updateUserId != ''">
				#{updateUserId,jdbcType=VARCHAR},
			</if>
			<if test="createUserId != null and createUserId != ''">
				#{createUserId,jdbcType=VARCHAR},
			</if>
			<if test="createUser != null and createUser != ''">
				#{createUser,jdbcType=VARCHAR},
			</if>
			<if test="checkOrder != null and checkOrder != ''">
				#{checkOrder,jdbcType=VARCHAR},
			</if>
			<if test="ext1 != null and ext1 != ''">
				#{ext1,jdbcType=VARCHAR},
			</if>
			<if test="ext3 != null and ext3 != ''">
				#{ext3,jdbcType=VARCHAR},
			</if>
			<if test="isComplete != null and isComplete != ''">
				#{isComplete,jdbcType=VARCHAR},
			</if>
			<if test="remark != null and remark != ''">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="fileUrl != null and fileUrl != ''">
				#{fileUrl,jdbcType=VARCHAR},
			</if>
			<if test="graduateUnvsName != null and graduateUnvsName != ''">
				#{graduateUnvsName,jdbcType=VARCHAR},
			</if>
			<if test="graduateTime != null and graduateTime != ''">
				#{graduateTime,jdbcType=VARCHAR},
			</if>
			<if test="graduateEdcsType != null and graduateEdcsType != ''">
				#{graduateEdcsType,jdbcType=VARCHAR},
			</if>
			<if test="graduateProfession != null and graduateProfession != ''">
				#{graduateProfession,jdbcType=VARCHAR},
			</if>
			<if test="graduateDiploma != null and graduateDiploma != ''">
				#{graduateDiploma,jdbcType=VARCHAR},
			</if>
			<if test="newGraduateUnvsName != null and newGraduateUnvsName != ''">
				#{newGraduateUnvsName,jdbcType=VARCHAR},
			</if>
			<if test="newGraduateTime != null and newGraduateTime != ''">
				#{newGraduateTime,jdbcType=VARCHAR},
			</if>
			<if test="newGraduateEdcsType != null and newGraduateEdcsType != ''">
				#{newGraduateEdcsType,jdbcType=VARCHAR},
			</if>
			<if test="newGraduateProfession != null and newGraduateProfession != ''">
				#{newGraduateProfession,jdbcType=VARCHAR},
			</if>
			<if test="newGraduateDiploma != null and newGraduateDiploma != ''">
				#{newGraduateDiploma,jdbcType=VARCHAR},
			</if>
			<if test="rprAddress != null and rprAddress != ''">
				#{rprAddress,jdbcType=VARCHAR},
			</if>
			<if test="newHkCode != null and newHkCode != ''">
				#{newHkCode,jdbcType=VARCHAR},
			</if>
			<if test="newRprAddress != null and newRprAddress != ''">
				#{newRprAddress,jdbcType=VARCHAR},
			</if>
			now()
		</trim>
	</insert>
	<delete id="deleteStudentModify">
		delete from bd_student_modify
		where modify_id in
		<foreach collection="ids" item="id" open="(" close=")"
			separator=",">
			#{id, jdbcType=CHAR}
		</foreach>
		and is_complete = '0'
	</delete>
	<update id="updateByPrimaryKeySelective" parameterType="com.yz.model.transfer.BdStudentModify">
		update bd_student_modify
		<set>
			<if test="learnId != null and '' != learnId">
				learn_id = #{learnId,jdbcType=VARCHAR},
			</if>
			<if test="checkOrder != null and '' != checkOrder">
				check_order = #{checkOrder,jdbcType=VARCHAR},
			</if>
			<if test="stdId != null and '' != stdId">
				std_id = #{stdId,jdbcType=VARCHAR},
			</if>
			<if test="modifyType != null and '' != modifyType">
				modify_type = #{modifyType,jdbcType=VARCHAR},
			</if>
			<if test="stdName != null and '' != stdName">
				std_name = #{stdName,jdbcType=VARCHAR},
			</if>
			<if test="sex != null and '' != sex">
				sex = #{sex,jdbcType=VARCHAR},
			</if>
			<if test="idType != null and '' != idType">
				id_type = #{idType,jdbcType=VARCHAR},
			</if>
			<if test="nation != null and '' != nation">
				nation = #{nation,jdbcType=VARCHAR},
			</if>
			<if test="idCard != null and '' != idCard">
				id_card = #{idCard,jdbcType=VARCHAR},
			</if>
			<if test="unvsId != null and '' != unvsId">
				unvs_id = #{unvsId,jdbcType=VARCHAR},
			</if>
			<if test="taId != null and '' != taId">
				ta_id = #{taId,jdbcType=VARCHAR},
			</if>
			<if test="pfsnId != null and '' != pfsnId">
				pfsn_id = #{pfsnId,jdbcType=VARCHAR},
			</if>
			<if test="scholarship != null and '' != scholarship">
				scholarship = #{scholarship,jdbcType=VARCHAR},
			</if>
			<if test="isComplete != null and '' != isComplete">
				is_complete = #{isComplete,jdbcType=VARCHAR},
			</if>
			<if test="newStdName != null and '' != newStdName">
				new_std_name = #{newStdName,jdbcType=VARCHAR},
			</if>
			<if test="newSex != null and '' != newSex">
				new_sex = #{newSex,jdbcType=VARCHAR},
			</if>
			<if test="newIdType != null and '' != newIdType">
				new_id_type = #{newIdType,jdbcType=VARCHAR},
			</if>
			<if test="newNation != null and '' != newNation">
				new_nation = #{newNation,jdbcType=VARCHAR},
			</if>
			<if test="newIdCard != null and '' != newIdCard">
				new_id_card = #{newIdCard,jdbcType=VARCHAR},
			</if>
			<if test="newUnvsId != null and '' != newUnvsId">
				new_unvs_id = #{newUnvsId,jdbcType=VARCHAR},
			</if>
			<if test="newTaId != null and '' != newTaId">
				new_ta_id = #{newTaId,jdbcType=VARCHAR},
			</if>
			<if test="newPfsnId != null and '' != newPfsnId">
				new_pfsn_id = #{newPfsnId,jdbcType=VARCHAR},
			</if>
			<if test="newScholarship != null and '' != newScholarship">
				new_scholarship = #{newScholarship,jdbcType=VARCHAR},
			</if>
			<if test="isDel != null and '' != isDel">
				is_del = #{isDel,jdbcType=CHAR},
			</if>
			<if test="updateUser != null and '' != updateUser">
				update_user = #{updateUser,jdbcType=VARCHAR},
			</if>
			<if test="updateUserId != null and '' != updateUserId">
				update_user_id = #{updateUserId,jdbcType=VARCHAR},
			</if>
			<if test="createUserId != null and '' != createUserId">
				create_user_id = #{createUserId,jdbcType=VARCHAR},
			</if>
			<if test="createUser != null and '' != createUser">
				create_user = #{createUser,jdbcType=VARCHAR},
			</if>
			<if test="ext1 != null and '' != ext1">
				ext_1 = #{ext1,jdbcType=VARCHAR},
			</if>
			<if test="ext2 != null and '' != ext2">
				ext_2 = #{ext2,jdbcType=VARCHAR},
			</if>
			<if test="ext3 != null and '' != ext3">
				ext_3 = #{ext3,jdbcType=VARCHAR},
			</if>
			<if test="remark != null and '' != remark">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			update_time = now()
		</set>
		where modify_id = #{modifyId,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.yz.model.transfer.BdStudentModify">
		update
		bd_student_modify
		set learn_id = #{learnId,jdbcType=VARCHAR},
		std_id =
		#{stdId,jdbcType=VARCHAR},
		modify_type =
		#{modifyType,jdbcType=VARCHAR},
		std_name = #{stdName,jdbcType=VARCHAR},
		sex = #{sex,jdbcType=VARCHAR},
		id_type = #{idType,jdbcType=VARCHAR},
		nation = #{nation,jdbcType=VARCHAR},
		id_card =
		#{idCard,jdbcType=VARCHAR},
		unvs_id = #{unvsId,jdbcType=VARCHAR},
		ta_id
		= #{taId,jdbcType=VARCHAR},
		pfsn_id = #{pfsnId,jdbcType=VARCHAR},
		scholarship = #{scholarship,jdbcType=VARCHAR},
		new_std_name =
		#{newStdName,jdbcType=VARCHAR},
		new_sex = #{newSex,jdbcType=VARCHAR},
		new_id_type = #{newIdType,jdbcType=VARCHAR},
		new_nation =
		#{newNation,jdbcType=VARCHAR},
		new_id_card =
		#{newIdCard,jdbcType=VARCHAR},
		new_unvs_id =
		#{newUnvsId,jdbcType=VARCHAR},
		new_ta_id = #{newTaId,jdbcType=VARCHAR},
		new_pfsn_id = #{newPfsnId,jdbcType=VARCHAR},
		new_scholarship =
		#{newScholarship,jdbcType=VARCHAR},
		is_del = #{isDel,jdbcType=CHAR},
		update_time = #{updateTime,jdbcType=TIMESTAMP},
		update_user =
		#{updateUser,jdbcType=VARCHAR},
		update_user_id =
		#{updateUserId,jdbcType=VARCHAR},
		create_user_id =
		#{createUserId,jdbcType=VARCHAR},
		create_time =
		#{createTime,jdbcType=TIMESTAMP},
		create_user =
		#{createUser,jdbcType=VARCHAR},
		ext_1 = #{ext1,jdbcType=VARCHAR},
		ext_2
		= #{ext2,jdbcType=VARCHAR},
		ext_3 = #{ext3,jdbcType=VARCHAR}
		where
		modify_id = #{modifyId,jdbcType=VARCHAR}
	</update>
	  
	<update id="updateBdStudentEnroll" parameterType="com.yz.model.transfer.BdStudentModify">
		update bd_student_enroll 
		<set>
		        update_time = now(),
			<if test="newScholarship != null and '' != newScholarship">
				scholarship = #{newScholarship,jdbcType=VARCHAR},
			</if>
			<if test="newUnvsId != null and '' != newUnvsId">
				unvs_id = #{newUnvsId,jdbcType=VARCHAR},
			</if>
			<if test="newPfsnId != null and '' != newPfsnId">
				pfsn_id = #{newPfsnId,jdbcType=VARCHAR},
				pfsn_level = (select pfsn_level from bd_unvs_profession where pfsn_id = #{newPfsnId}),
			</if>
			<if test="newTaId != null and '' != newTaId">
				ta_id = #{newTaId,jdbcType=VARCHAR},
			</if>
		</set>
		where learn_id = #{learnId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateBdLearnInfo" parameterType="com.yz.model.transfer.BdStudentModify">
		update bd_learn_info
		<set>
		        update_time = now(),
		    <if test="feeId != null and '' != feeId">
				fee_id = #{feeId,jdbcType=VARCHAR},
			</if>
			<if test="offerId != null and '' != offerId">
				offer_id = #{offerId,jdbcType=VARCHAR},
			</if>
			<if test="newScholarship != null and '' != newScholarship">
				scholarship = #{newScholarship,jdbcType=VARCHAR},
			</if>
			<if test="newUnvsId != null and '' != newUnvsId">
				unvs_id = #{newUnvsId,jdbcType=VARCHAR},
			</if>
			<if test="newPfsnId != null and '' != newPfsnId">
				pfsn_id = #{newPfsnId,jdbcType=VARCHAR},
			</if>
			<if test="newTaId != null and '' != newTaId">
				ta_id = #{newTaId,jdbcType=VARCHAR},
			</if>
		</set>
		where learn_id = #{learnId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateBdStudentInfo" parameterType="com.yz.model.transfer.BdStudentModify">
		update bd_student_info
		<set>
		    update_time = now(),
			<if test="newStdName != null and '' != newStdName">
				std_name = #{newStdName,jdbcType=VARCHAR},
			</if>
			<if test="newIdCard != null and '' != newIdCard">
				id_card = #{newIdCard,jdbcType=VARCHAR},
			</if>
			<if test="newSex != null and '' != newSex">
				sex = #{newSex,jdbcType=VARCHAR},
			</if>
			<if test="newNation != null and '' != newNation">
				nation = #{newNation,jdbcType=VARCHAR},
			</if>
			<if test="newHkCode != null and '' != newHkCode">
				rpr_address_code = #{newHkCode,jdbcType=VARCHAR},
			</if>
		</set>
		where std_id = #{stdId,jdbcType=VARCHAR}
	</update>
	
	<update id="updateStdOrderStatusByLearnId" parameterType="java.lang.String">
		update 
		  bd_student_order o 
		  inner join bd_sub_order s 
		    on s.order_no = o.order_no set s.sub_order_status = '4' 
		where o.learn_id = #{learnId}
	</update>

	<select id="findStudentRollModifyNew" resultMap="RollResultMap"
			parameterType="com.yz.model.transfer.StudentModifyQuery">
		SELECT
		a.modify_id,
		a.std_name,
		a.id_card,
		a.sex,
		a.nation,
		a.pfsn_id,
		b.grade,
		a.check_order,
		b.std_stage,
		b.scholarship,
		b.inclusion_status,
		a.new_std_name,
		a.new_id_card,
		a.new_sex,
		a.new_nation,
		a.new_pfsn_id,
		pro.pfsn_name,
		pro_new.pfsn_name npfsn_name,
		pro.pfsn_code,
		pro.pfsn_level,
		a.create_user,
		a.create_time,
		c.unvs_name,
		d.check_status,
		d.cr_id,
		d.update_time,
		unvs_new.unvs_name nunvs_name,
		pro_new.pfsn_level new_pfsn_level,
		bta.ta_name,
		bta_new.ta_name nta_name
		FROM
		bd_student_modify a
		LEFT JOIN bd_learn_info b ON a.learn_id = b.learn_id
		LEFT JOIN bd_university c ON a.unvs_id = c.unvs_id
		LEFT JOIN bd_university unvs_new ON a.new_unvs_id = unvs_new.unvs_id
		LEFT JOIN bd_unvs_profession pro ON a.pfsn_id = pro.pfsn_id
		LEFT JOIN bd_unvs_profession pro_new ON a.new_pfsn_id = pro_new.pfsn_id
		LEFT JOIN bd_check_record d ON d.mapping_id = a.modify_id  AND d.check_order = a.check_order
		LEFT JOIN bd_learn_rules e ON a.learn_id = e.learn_id
		LEFT  JOIN bd_student_info f ON  f.std_id = b.std_id
		LEFT JOIN bd_test_area bta ON bta.`ta_id` = a.`ta_id`
		LEFT JOIN bd_test_area bta_new ON bta_new.`ta_id` = a.`new_ta_id`
		WHERE
		a.modify_type = '6'
		AND d.check_type = '10'
		<if test="query.stdName != null and query.stdName != ''">
			AND a.`std_name` LIKE CONCAT('%', #{query.stdName,jdbcType=VARCHAR}, '%')
		</if>
		<if test="query.idCard != null and query.idCard != ''">
			AND a.`id_card` LIKE CONCAT('%', #{query.idCard,jdbcType=VARCHAR}, '%')
		</if>
		<if test="query.mobile != null and query.mobile != ''">
			AND f.`mobile` LIKE CONCAT('%', #{query.mobile,jdbcType=VARCHAR}, '%')
		</if>
		<if test="query.unvsId != null and query.unvsId != ''">
			AND a.`unvs_id` = #{query.unvsId,jdbcType=VARCHAR}
		</if>
		<if test="query.pfsnId != null and query.pfsnId != ''">
			AND pro.`pfsn_id` = #{query.pfsnId ,jdbcType=VARCHAR}
		</if>
		<if test="query.pfsnLevel != null and query.pfsnLevel != ''">
			AND pro.`pfsn_level` = #{query.pfsnLevel,jdbcType=VARCHAR}
		</if>
		<if test="query.grade != null and query.grade != ''">
			AND b.`grade` = #{query.grade,jdbcType=VARCHAR}
		</if>
		<if test="query.createUser != null and '' != query.createUser">
			AND a.create_user LIKE CONCAT('%', #{query.createUser,jdbcType=VARCHAR}, '%')
		</if>
		<if test="query.recruitType != null and query.recruitType != ''">
			AND b.`recruit_type` = #{query.recruitType,jdbcType=VARCHAR}
		</if>
		<if test="query.stdStage != null and query.stdStage != ''">
			AND b.`std_stage` = #{query.stdStage,jdbcType=VARCHAR}
		</if>
		<if test="query.createStartTime != null and query.createStartTime != ''">
			AND a.`create_time` >= #{query.createStartTime,jdbcType=VARCHAR}
		</if>
		<if test="query.createEndTime != null and query.createEndTime != ''">
			AND a.`create_time` &lt;= #{query.createEndTime,jdbcType=VARCHAR}
		</if>
		<if test="query.checkStartTime != null and query.checkStartTime != ''">
			AND (a.check_order=3 AND d.check_status=2 AND d.`update_time` >= #{query.checkStartTime,jdbcType=VARCHAR})
		</if>
		<if test="query.checkEndTime != null and query.checkEndTime != ''">
			AND (a.check_order=3 AND d.check_status=2 AND d.`update_time` &lt;= #{query.checkEndTime,jdbcType=VARCHAR})
		</if>
		<if test="query.checkOrder != null and query.checkOrder != ''">
			AND a.`check_order` = #{query.checkOrder,jdbcType=VARCHAR} AND d.check_status ='1'
		</if>
		<if test="query.changeType != null and query.changeType != ''">
			AND (a.ext_3 = #{query.changeType} or a.ext_3 = '3')
		</if>
		<if test="query.checkStatus != null and query.checkStatus != ''">
			<if test="query.checkStatus == 0">
				and d.check_status = 3
			</if>
			<if test="query.checkStatus == 1">
				and a.check_order = 1 and d.check_status = 1
			</if>
			<if test="query.checkStatus == 2">
				and a.check_order = 2 and d.check_status = 1
			</if>
			<if test="query.checkStatus == 3">
				and a.check_order = 3 and d.check_status = 1
			</if>
			<if test="query.checkStatus == 4">
				and a.check_order = 3 and d.check_status = 2
			</if>
		</if>
		<if test="user.userLevel != 1">
			<choose>
				<when test="user.userLevel == 6">
					and e.tutor = #{user.empId, jdbcType=VARCHAR}
				</when>
				<otherwise>
					and a.create_user_id = #{user.userId, jdbcType=VARCHAR}
				</otherwise>
			</choose>
		</if>
		order by create_time desc
	</select>

	<select id="findStudentRollModifyNewById" resultMap="RollBaseResultMap"
			parameterType="java.lang.String">
		SELECT
		bsm.*,
		bli.`scholarship` bScholarship,
		bli.`grade`,
		bli.`learn_stage`,
		bli.`std_stage`,
		bup.`pfsn_name`,
		bup.`pfsn_level`,
		bu.`unvs_name`,
		bu.`recruit_type`,
		bup.`pfsn_level`,
		bup.`pfsn_code`,
		bcr.`cr_id`,
		date_format(bcr.`update_time`, '%Y-%m-%d %H:%i:%s')  bcrUpdateTime,
		bcr.`reason`,
		oe.`emp_name`,
		bta.`ta_name`,
		bli.inclusion_status,
		score.score,
		(SELECT
		pfsn_name
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_name,
		(SELECT
		pfsn_level
		FROM
		bd_unvs_profession
		WHERE pfsn_id = bsm.`new_pfsn_id`) npfsn_level,
		(SELECT
		unvs_name
		FROM
		bd_university
		WHERE unvs_id = bsm.`new_unvs_id`) nunvs_name,
		(SELECT
		ta_name
		FROM
		bd_test_area
		WHERE ta_id = bsm.`new_ta_id`) nta_name
		FROM
		`bd_student_modify` bsm
		LEFT JOIN bd_learn_info bli
		ON bsm.`learn_id` = bli.`learn_id`
		LEFT JOIN bd_unvs_profession bup
		ON bup.`pfsn_id` = bsm.`pfsn_id`
		LEFT JOIN bd_university bu
		ON bu.`unvs_id` = bsm.`unvs_id`
		LEFT JOIN bd_check_record bcr
		ON bcr.`mapping_id` = bsm.`modify_id`
		LEFT JOIN `oa_employee` oe
		ON bcr.`emp_id` = oe.`emp_id`
		LEFT JOIN bd_test_area bta
		ON bta.`ta_id` = bsm.`ta_id`
		LEFT JOIN (
			SELECT learn_id,SUM(score) score FROM bd_student_e_score GROUP BY learn_id
		) score
		on bsm.`learn_id` = score.learn_id
		WHERE bsm.`modify_id` =
		#{modifyId,jdbcType=VARCHAR} ORDER BY bcr.`check_order` ASC
	</select>

	<select id="findStudentInfoNew" resultMap="StudentInfoMap"
			parameterType="java.lang.String">
		SELECT
			a.learn_id,
			b.std_id,
			b.std_name,
			a.grade,
			b.id_card
		FROM
			bd_learn_info a
		LEFT JOIN bd_student_info b ON a.std_id = b.std_id
		LEFT JOIN bd_learn_rules e ON a.learn_id = e.learn_id
		WHERE
			(
				(
					a.recruit_type = 1
					AND a.std_stage = '7'
				)
				OR (
					a.recruit_type = 2
					AND a.std_stage IN ('5', '6', '7', '12')
				)
			)
		<if test="sName != null and sName != ''">
			AND (
				b.id_card = #{sName,jdbcType=VARCHAR}
				OR b.std_name like CONCAT('%',#{sName,jdbcType=VARCHAR},'%')
			)
		</if>
		<if test="user.userLevel != 1">
			<choose>
				<when test="user.userLevel == 6">
					and e.tutor = #{user.empId, jdbcType=VARCHAR}
				</when>
				<when test="user.userLevel == 7">
					AND a.recruit_type = 1
					AND a.std_stage = '7'
				</when>
				<when test="user.userLevel == 8">
					AND recruit_type = 2
					AND a.std_stage IN ('5', '6', '7', '12')
				</when>
				<otherwise>

				</otherwise>
			</choose>
		</if>
	</select>

	<select id="countYMStudent" resultType="java.lang.Integer">
		SELECT
		count(*)
		FROM
		bd_learn_info
		WHERE
		grade = '2018'
		AND inclusion_status = 2
		AND scholarship IN ('15', '16', '17', '22')
		AND learn_id = #{learnId, jdbcType=VARCHAR}
	</select>

	<select id="getAccAmount" resultType="java.util.Map">
		SELECT
		Convert(IFNULL(SUM(ss.`amount`),'0'),char(20)) amount,o.order_no orderNo
		FROM
		  bd_student_order o
		  LEFT JOIN bd_sub_order so
			ON so.`order_no` = o.`order_no`
		  LEFT JOIN bd_serial_suborder su
			ON su.`sub_order_no` = so.`sub_order_no`
		  LEFT JOIN bd_fee_item i
			ON i.`item_code` = so.`item_code`
		  LEFT JOIN bd_student_serial s
			ON s.`serial_no` = su.`serial_no`
		  LEFT JOIN bd_sub_serial ss
			ON s.`serial_no` = ss.`serial_no`
		WHERE ss.`sub_serial_status` IN ('2', '3')
		   <if test="accType==3">
				AND ss.`payment_type` IN ('1', '2', '4', '5', '6', '10', '11')
		   </if>
		   <if test="accType==2">
		  		AND ss.`payment_type` = '7'
		   </if>
		  AND so.`sub_order_status` = '2'
		  AND i.`item_type` != '1'
		  AND o.`learn_id` = #{learnId, jdbcType=VARCHAR}
	</select>

	<select id="getCouponIds" resultType="java.lang.String">
		SELECT
		  ss.`coupon_id`
		FROM
		  bd_student_order o
		  LEFT JOIN bd_sub_order so
			ON so.`order_no` = o.`order_no`
		  LEFT JOIN bd_serial_suborder su
			ON su.`sub_order_no` = so.`sub_order_no`
		  LEFT JOIN bd_fee_item i
			ON i.`item_code` = so.`item_code`
		  LEFT JOIN bd_student_serial s
			ON s.`serial_no` = su.`serial_no`
		  LEFT JOIN bd_sub_serial ss
			ON s.`serial_no` = ss.`serial_no`
		WHERE ss.`sub_serial_status` IN ('2', '3')
		  AND ss.`payment_type` = '8'
		  AND so.`sub_order_status` = '2'
		  AND i.`item_type` != '1'
		  AND o.`learn_id` = #{learnId, jdbcType=VARCHAR}
	</select>

	<update id="updateCouponUse">
		UPDATE bd_student_coupon
		SET is_use = '0',used_time = NULL
		WHERE
			std_id = #{stdId, jdbcType=VARCHAR}
		AND coupon_id IN
		<foreach collection="couponIds" item="couponId"  open="(" close=")" separator=",">
			#{couponId}
		</foreach>
	</update>

	<update id="updateOrderStatus">
		UPDATE
		bd_student_order bs
		LEFT JOIN bd_sub_order bso
		ON bso.`order_no` = bs.`order_no`
		SET bso.`sub_order_status` =
		CASE
		bso.`sub_order_status`
		WHEN '1'
		THEN '4'
		WHEN '5'
		THEN '3'
		WHEN '2'
		THEN '3'
		ELSE '4'
		END
		WHERE bs.`learn_id` = #{learnId, jdbcType=VARCHAR}
	</update>

	<select id="countFinish" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM
			bd_student_modify
		WHERE
			modify_type = '6'
		AND new_pfsn_id IS NULL
		AND is_complete = '0'
		AND learn_id = #{learnId, jdbcType=VARCHAR}
	</select>

	<select id="countNewPfsnFinish" resultType="java.lang.Integer">
		SELECT
		count(*)
		FROM
		bd_student_modify
		WHERE
		modify_type = '6'
		AND new_pfsn_id IS NOT NULL
		AND is_complete = '1'
		AND ext_2 = ' '
		AND learn_id = #{learnId, jdbcType=VARCHAR}
	</select>
	<select id="isExamLoading" resultType="java.lang.Integer">
		select COUNT(1) from bms.net_report_data WHERE learn_id = #{learnId};
	</select>
</mapper>